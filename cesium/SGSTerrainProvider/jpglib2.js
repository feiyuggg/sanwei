var JpegImage=function(){"use strict";var e=new Uint8Array([0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0]),r=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11]),n=new Uint8Array([0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0]),a=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11]),o=new Uint8Array([0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125]),t=new Uint8Array([1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250]),s=new Uint8Array([0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119]),i=new Uint8Array([0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250]),c=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),f=4017,l=799,h=3406,u=2276,p=1567,m=3784,v=5793,d=2896;function b(){}function w(e,r){for(var n,a,o=0,t=[],s=16;s>0&&!e[s-1];)s--;t.push({children:[],index:0});var i,c=t[0];for(n=0;n<s;n++){for(a=0;a<e[n];a++){for((c=t.pop()).children[c.index]=r[o];c.index>0;)c=t.pop();for(c.index++,t.push(c);t.length<=n;)t.push(i={children:[],index:0}),c.children[c.index]=i.children,c=i;o++}n+1<s&&(t.push(i={children:[],index:0}),c.children[c.index]=i.children,c=i)}return t[0].children}function k(e,r,n,a,o,t,s,i,f){n.precision,n.samplesPerLine,n.scanLines;var l=n.mcusPerLine,h=n.progressive,u=(n.maxH,n.maxV,r),p=0,m=0;function v(){if(m>0)return p>>--m&1;if(255==(p=e[r++])){var n=e[r++];if(n)throw"unexpected marker: "+(p<<8|n).toString(16)}return m=7,p>>>7}function d(e){for(var r,n=e;null!==(r=v());){if("number"==typeof(n=n[r]))return n;if("object"!=typeof n)throw"invalid huffman sequence"}return null}function b(e){for(var r=0;e>0;){var n=v();if(null===n)return;r=r<<1|n,e--}return r}function w(e){var r=b(e);return r>=1<<e-1?r:r+(-1<<e)+1}var k=0;var y,g=0;function A(e,r,n,a,o){var t=n%l,s=(n/l|0)*e.v+a,i=t*e.h+o;r(e,e.blocks[s][i])}function P(e,r,n){var a=n/e.blocksPerLine|0,o=n%e.blocksPerLine;r(e,e.blocks[a][o])}var T,x,U,X,L,C,I=a.length;C=h?0===t?0===i?function(e,r){var n=d(e.huffmanTableDC),a=0===n?0:w(n)<<f;r[0]=e.pred+=a}:function(e,r){r[0]|=v()<<f}:0===i?function(e,r){if(k>0)k--;else for(var n=t,a=s;n<=a;){var o=d(e.huffmanTableAC),i=15&o,l=o>>4;if(0!==i)r[c[n+=l]]=w(i)*(1<<f),n++;else{if(l<15){k=b(l)+(1<<l)-1;break}n+=16}}}:function(e,r){for(var n=t,a=s,o=0;n<=a;){var i=c[n];switch(g){case 0:var l=d(e.huffmanTableAC),h=15&l;if(o=l>>4,0===h)o<15?(k=b(o)+(1<<o),g=4):(o=16,g=1);else{if(1!==h)throw"invalid ACn encoding";y=w(h),g=o?2:3}continue;case 1:case 2:r[i]?r[i]+=v()<<f:0==--o&&(g=2==g?3:0);break;case 3:r[i]?r[i]+=v()<<f:(r[i]=y<<f,g=0);break;case 4:r[i]&&(r[i]+=v()<<f)}n++}4===g&&0==--k&&(g=0)}:function(e,r){var n=d(e.huffmanTableDC),a=0===n?0:w(n);r[0]=e.pred+=a;for(var o=1;o<64;){var t=d(e.huffmanTableAC),s=15&t,i=t>>4;if(0!==s)r[c[o+=i]]=w(s),o++;else{if(i<15)break;o+=16}}};var D,Y,z,q,M=0;for(Y=1==I?a[0].blocksPerLine*a[0].blocksPerColumn:l*n.mcusPerColumn,o||(o=Y);M<Y;){for(x=0;x<I;x++)a[x].pred=0;if(k=0,1==I)for(T=a[0],L=0;L<o;L++)P(T,C,M),M++;else for(L=0;L<o;L++){for(x=0;x<I;x++)for(z=(T=a[x]).h,q=T.v,U=0;U<q;U++)for(X=0;X<z;X++)A(T,C,M,U,X);if(++M===Y)break}if(m=0,(D=e[r]<<8|e[r+1])<65280)throw"marker was not found";if(!(D>=65488&&D<=65495))break;r+=2}return r-u}function y(e,r){var n,a,o=[],t=r.blocksPerLine,s=r.blocksPerColumn,i=t<<3,c=new Int32Array(64),b=new Uint8Array(64);function w(e,n,a){var o,t,s,i,c,b,w,k,y,g,A=r.quantizationTable,P=a;for(g=0;g<64;g++)P[g]=e[g]*A[g];for(g=0;g<8;++g){var T=8*g;0!=P[1+T]||0!=P[2+T]||0!=P[3+T]||0!=P[4+T]||0!=P[5+T]||0!=P[6+T]||0!=P[7+T]?(o=v*P[0+T]+128>>8,t=v*P[4+T]+128>>8,s=P[2+T],i=P[6+T],c=d*(P[1+T]-P[7+T])+128>>8,k=d*(P[1+T]+P[7+T])+128>>8,b=P[3+T]<<4,w=P[5+T]<<4,y=o-t+1>>1,o=o+t+1>>1,t=y,y=s*m+i*p+128>>8,s=s*p-i*m+128>>8,i=y,y=c-w+1>>1,c=c+w+1>>1,w=y,y=k+b+1>>1,b=k-b+1>>1,k=y,y=o-i+1>>1,o=o+i+1>>1,i=y,y=t-s+1>>1,t=t+s+1>>1,s=y,y=c*u+k*h+2048>>12,c=c*h-k*u+2048>>12,k=y,y=b*l+w*f+2048>>12,b=b*f-w*l+2048>>12,w=y,P[0+T]=o+k,P[7+T]=o-k,P[1+T]=t+w,P[6+T]=t-w,P[2+T]=s+b,P[5+T]=s-b,P[3+T]=i+c,P[4+T]=i-c):(y=v*P[0+T]+512>>10,P[0+T]=y,P[1+T]=y,P[2+T]=y,P[3+T]=y,P[4+T]=y,P[5+T]=y,P[6+T]=y,P[7+T]=y)}for(g=0;g<8;++g){var x=g;0!=P[8+x]||0!=P[16+x]||0!=P[24+x]||0!=P[32+x]||0!=P[40+x]||0!=P[48+x]||0!=P[56+x]?(o=v*P[0+x]+2048>>12,t=v*P[32+x]+2048>>12,s=P[16+x],i=P[48+x],c=d*(P[8+x]-P[56+x])+2048>>12,k=d*(P[8+x]+P[56+x])+2048>>12,b=P[24+x],w=P[40+x],y=o-t+1>>1,o=o+t+1>>1,t=y,y=s*m+i*p+2048>>12,s=s*p-i*m+2048>>12,i=y,y=c-w+1>>1,c=c+w+1>>1,w=y,y=k+b+1>>1,b=k-b+1>>1,k=y,y=o-i+1>>1,o=o+i+1>>1,i=y,y=t-s+1>>1,t=t+s+1>>1,s=y,y=c*u+k*h+2048>>12,c=c*h-k*u+2048>>12,k=y,y=b*l+w*f+2048>>12,b=b*f-w*l+2048>>12,w=y,P[0+x]=o+k,P[56+x]=o-k,P[8+x]=t+w,P[48+x]=t-w,P[16+x]=s+b,P[40+x]=s-b,P[24+x]=i+c,P[32+x]=i-c):(y=v*a[g+0]+8192>>14,P[0+x]=y,P[8+x]=y,P[16+x]=y,P[24+x]=y,P[32+x]=y,P[40+x]=y,P[48+x]=y,P[56+x]=y)}for(g=0;g<64;++g){var U=128+(P[g]+8>>4);n[g]=U<0?0:U>255?255:U}}for(var k=0;k<s;k++){var y=k<<3;for(n=0;n<8;n++)o.push(new Uint8Array(i));for(var g=0;g<t;g++){w(r.blocks[k][g],b,c);var A=0,P=g<<3;for(a=0;a<8;a++){var T=o[y+a];for(n=0;n<8;n++)T[P+n]=b[A++]}}}return o}function g(e){return e<0?0:e>255?255:e}return b.prototype={load:function(e){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){var e=new Uint8Array(r.response||r.mozResponseArrayBuffer);this.parse(e),this.onload&&this.onload()}.bind(this),r.send(null)},parse:function(f,l){var h=0;f.length;function u(){var e=f[h]<<8|f[h+1];return h+=2,e}function p(){var e=u(),r=f.subarray(h,h+e-2);return h+=r.length,r}function m(e){var r,n,a=0,o=0;for(n in e.components)e.components.hasOwnProperty(n)&&(a<(r=e.components[n]).h&&(a=r.h),o<r.v&&(o=r.v));var t=Math.ceil(e.samplesPerLine/8/a),s=Math.ceil(e.scanLines/8/o);for(n in e.components)if(e.components.hasOwnProperty(n)){r=e.components[n];for(var i=Math.ceil(Math.ceil(e.samplesPerLine/8)*r.h/a),c=Math.ceil(Math.ceil(e.scanLines/8)*r.v/o),f=t*r.h,l=s*r.v,h=[],u=0;u<l;u++){for(var p=[],m=0;m<f;m++)p.push(new Int32Array(64));h.push(p)}r.blocksPerLine=i,r.blocksPerColumn=c,r.blocks=h}e.maxH=a,e.maxV=o,e.mcusPerLine=t,e.mcusPerColumn=s}var v,d,b=null,g=null,A=[],P=[],T=[],x=[],U=u();if(65496!=U)throw"SOI not found";var X=f[5];(X<=0||X>100)&&(X=90);var L,C,I;for(L=f[4],X>=0&&(C=createQuantizationTables(X,0),I=createQuantizationTables(X,1)),l&&(f[2]=255,f[3]=224,f[4]=0,f[5]=16,f[6]=74,f[7]=70,f[8]=73,f[9]=70,1&L&&(A[0]=C,A[1]=I),2&L&&(x[0]=w(e,r),T[0]=w(o,t),x[1]=w(n,a),T[1]=w(s,i))),U=u();65497!=U;){switch(U){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var D=p();65504===U&&74===D[0]&&70===D[1]&&73===D[2]&&70===D[3]&&0===D[4]&&(b={version:{major:D[5],minor:D[6]},densityUnits:D[7],xDensity:D[8]<<8|D[9],yDensity:D[10]<<8|D[11],thumbWidth:D[12],thumbHeight:D[13],thumbData:D.subarray(14,14+3*D[12]*D[13])}),65518===U&&65===D[0]&&100===D[1]&&111===D[2]&&98===D[3]&&101===D[4]&&0===D[5]&&(g={version:D[6],flags0:D[7]<<8|D[8],flags1:D[9]<<8|D[10],transformCode:D[11]});break;case 65499:for(var Y=u()+h-2;h<Y;){var z=f[h++],q=new Int32Array(64);if(z>>4==0)for(ee=0;ee<64;ee++){q[c[ee]]=f[h++]}else{if(z>>4!=1)throw"DQT: invalid table spec";for(ee=0;ee<64;ee++){q[c[ee]]=u()}}A[15&z]=q}break;case 65472:case 65473:case 65474:u(),(v={}).extended=65473===U,v.progressive=65474===U,v.precision=f[h++],v.scanLines=u(),v.samplesPerLine=u(),v.components={},v.componentsOrder=[];var M,O=f[h++];for($=0;$<O;$++){M=f[h];var H=f[h+1]>>4,J=15&f[h+1],Q=f[h+2];v.componentsOrder.push(M),v.components[M]={h:H,v:J,quantizationIdx:Q},h+=3}m(v),P.push(v);break;case 65476:var j=u();for($=2;$<j;){var E=f[h++],G=new Uint8Array(16),S=0;for(ee=0;ee<16;ee++,h++)S+=G[ee]=f[h];var V=new Uint8Array(S);for(ee=0;ee<S;ee++,h++)V[ee]=f[h];$+=17+S,(E>>4==0?x:T)[15&E]=w(G,V)}break;case 65501:u(),d=u();break;case 65498:u();var B=f[h++],R=[];for($=0;$<B;$++){re=v.components[f[h++]];var N=f[h++];re.huffmanTableDC=x[N>>4],re.huffmanTableAC=T[15&N],R.push(re)}var W=f[h++],F=f[h++],K=f[h++],Z=k(f,h,v,R,d,W,F,K>>4,15&K);h+=Z;break;default:if(255==f[h-3]&&f[h-2]>=192&&f[h-2]<=254){h-=3;break}throw"unknown JPEG marker "+U.toString(16)}U=u()}if(1!=P.length)throw"only single frame JPEGs supported";for(var $=0;$<P.length;$++){var _=P[$].components;for(var ee in _)_[ee].quantizationTable=A[_[ee].quantizationIdx],delete _[ee].quantizationIdx}this.width=v.samplesPerLine,this.height=v.scanLines,this.jfif=b,this.adobe=g,this.components=[];for($=0;$<v.componentsOrder.length;$++){var re=v.components[v.componentsOrder[$]];this.components.push({lines:y(0,re),scaleX:re.h/v.maxH,scaleY:re.v/v.maxV})}},getData:function(e,r){var n,a,o,t,s,i,c,f,l,h,u,p,m,v,d,b,w,k,y,A,P,T=this.width/e,x=this.height/r,U=0,X=e*r*this.components.length,L=new Uint8Array(X);switch(this.components.length){case 1:for(n=this.components[0],h=0;h<r;h++)for(s=n.lines[0|h*n.scaleY*x],l=0;l<e;l++)u=s[0|l*n.scaleX*T],L[U++]=u;break;case 2:for(n=this.components[0],a=this.components[1],h=0;h<r;h++)for(s=n.lines[0|h*n.scaleY*x],i=a.lines[0|h*a.scaleY*x],l=0;l<e;l++)u=s[0|l*n.scaleX*T],L[U++]=u,u=i[0|l*a.scaleX*T],L[U++]=u;break;case 3:for(P=!0,this.adobe&&this.adobe.transformCode?P=!0:void 0!==this.colorTransform&&(P=!!this.colorTransform),n=this.components[0],a=this.components[1],o=this.components[2],h=0;h<r;h++)for(s=n.lines[0|h*n.scaleY*x],i=a.lines[0|h*a.scaleY*x],c=o.lines[0|h*o.scaleY*x],l=0;l<e;l++)P?(u=s[0|l*n.scaleX*T],p=i[0|l*a.scaleX*T],k=g(u+1.402*((m=c[0|l*o.scaleX*T])-128)),y=g(u-.3441363*(p-128)-.71413636*(m-128)),A=g(u+1.772*(p-128))):(k=s[0|l*n.scaleX*T],y=i[0|l*a.scaleX*T],A=c[0|l*o.scaleX*T]),L[U++]=k,L[U++]=y,L[U++]=A;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";for(P=!1,this.adobe&&this.adobe.transformCode?P=!0:void 0!==this.colorTransform&&(P=!!this.colorTransform),n=this.components[0],a=this.components[1],o=this.components[2],t=this.components[3],h=0;h<r;h++)for(s=n.lines[0|h*n.scaleY*x],i=a.lines[0|h*a.scaleY*x],c=o.lines[0|h*o.scaleY*x],f=t.lines[0|h*t.scaleY*x],l=0;l<e;l++)P?(u=s[0|l*n.scaleX*T],p=i[0|l*a.scaleX*T],m=c[0|l*o.scaleX*T],v=f[0|l*t.scaleX*T],d=255-g(u+1.402*(m-128)),b=255-g(u-.3441363*(p-128)-.71413636*(m-128)),w=255-g(u+1.772*(p-128))):(d=s[0|l*n.scaleX*T],b=i[0|l*a.scaleX*T],w=c[0|l*o.scaleX*T],v=f[0|l*t.scaleX*T]),L[U++]=255-d,L[U++]=255-b,L[U++]=255-w,L[U++]=255-v;break;default:throw"Unsupported color mode"}return L},copyToImageData:function(e){var r,n,a,o,t,s,i,c,f,l=e.width,h=e.height,u=e.data,p=this.getData(l,h),m=0,v=0;switch(this.components.length){case 1:for(n=0;n<h;n++)for(r=0;r<l;r++)a=p[m++],u[v++]=a,u[v++]=a,u[v++]=a,u[v++]=255;break;case 3:for(n=0;n<h;n++)for(r=0;r<l;r++)i=p[m++],c=p[m++],f=p[m++],u[v++]=i,u[v++]=c,u[v++]=f,u[v++]=255;break;case 4:for(n=0;n<h;n++)for(r=0;r<l;r++)t=p[m++],s=p[m++],a=p[m++],i=255-g(t*(1-(o=p[m++])/255)+o),c=255-g(s*(1-o/255)+o),f=255-g(a*(1-o/255)+o),u[v++]=i,u[v++]=c,u[v++]=f,u[v++]=255;break;default:throw"Unsupported color mode"}}},b}();function decode(e,r,n){var a=new JpegImage;a.parse(e,n);var o={compNum:a.components.length,width:a.width,height:a.height,data:r?new Uint8Array(a.width*a.height*4):new Buffer(a.width*a.height*4)};return a.copyToImageData(o),o}function createQuantizationTables(e,r){var n,a=new Uint32Array(64);e<=0&&(e=1),e>100&&(e=100),e=e<50?5e3/e:200-2*e,n=[[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99]][r];for(var o=0;o<64;o++)temp=(n[o]*e+50)/100,temp<=0&&(temp=1),temp>32767&&(temp=32767),temp>255&&(temp=255),a[o]=temp;return a}