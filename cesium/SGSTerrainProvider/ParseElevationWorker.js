function isPNG(e){if(e.buffer.byteLength>2){var t=new Uint8Array(e.buffer.byteLength>0?e.buffer.slice(1,4):0);return 0==t.length||t[0]=="P".charCodeAt()&&t[1]=="N".charCodeAt()&&t[2]=="G".charCodeAt()}return!1}function isMPT(e){if(e.buffer.byteLength>80){var t=new DataView(e.buffer);t.getUint32(64,!0),t.getUint32(68,!0),t.getUint32(72,!0);return 1==t.getUint32(76,!0)}return!1}function getRandomIntInclusive(e,t){return Math.floor(Math.random()*(t-e+1))+e}function JPEGDecompress(e){var t,r,n,i=new Uint8Array(e),s=new DataView(i.buffer);t=s.getFloat32(0,!0),r=s.getFloat32(4,!0),n=i.slice(8,264);var a=i.slice(264,i.byteLength),f=decode(a,!0,1);if(!isNaN(f.data[0]))return(new JPEGElevDecompress).ElevDecompress(f,n,t,r);console.error("Error while JPEG Decompressing")}function PNGDecompress(e){for(var t=new Uint8Array(e),r=new DataView(e),n=r.getFloat32(0,!0),i=r.getFloat32(4,!0)-n,s=t.slice(8,t.buffer.byteLength),a=new PNG(new Uint8Array(s)).decodePixels(),f=new Float32Array(a.length/2),o=new DataView(a.buffer),c=0;c<a.length/2;c++)f[c]=o.getUint16(2*c),65535!=f[c]&&(f[c]=f[c]*i/65535+n);return f}function PNG16_8Decompress(e){for(var t,r=new Uint8Array(e),n=new DataView(r.buffer),i=8+(t=n.getUint32(0,!0))+n.getUint32(4,!0),s=r.slice(8,8+t),a=new PNG(new Uint8Array(s)).decodePixels(),f=new DataView(a.buffer),o=r.slice(8+t,i),c=new PNG(new Uint8Array(o)).decodePixels(),g=(new DataView(a.buffer),new Float32Array(65536)),l=0;l<256;l++)for(var u=0;u<256;u++)g[u+256*l]=.3048*(f.getInt16(2*(u+256*l))+c[u+256*l]/256);return g}importScripts("zlib.js"),importScripts("png.js"),importScripts("ElevDecompress.js"),importScripts("jpglib2.js"),self.addEventListener("message",function(e){var t=e.data;if(t.rejected=!1,isPNG(t)){for(var r=new PNG(new Uint8Array(t.buffer)).decodePixels(),n=new Int16Array(r.length/2),i=0;i<r.length/2;i++)n[i]=r[2*i]<<8|r[2*i+1],65535!=n[i]&&(n[i]=.3048*n[i]);t.buffer=n,postMessage(t)}else if(isMPT(t)){var s=new DataView(t.buffer),a=s.getUint32(64,!0),f=(s.getUint32(68,!0),s.getUint32(72,!0),s.getUint32(76,!0),(16777215&s.getUint32(100,!0))-(16777215&s.getUint32(96,!0))),o=(16777215&s.getUint32(104,!0))-(16777215&s.getUint32(100,!0)),c=96+f+a,g=16777215&s.getUint32(c+0,!0),l=s.getUint32(c+4,!0),u=String.fromCharCode(l>>24),w=c+g,b=w+o;if("N"==u){var p=PNG16_8Decompress(t.buffer.slice(w,b));t.buffer=p,postMessage(t)}else if("B"==u){for(p=JPEGDecompress(t.buffer.slice(w,b)),n=new Uint16Array(p.byteLength),i=0;i<65536;i++){var U=Math.fmod(p[i],Math.pow(2,32));65535!=U&&(n[i]=U)}t.buffer=n,postMessage(t)}else if("A"==u){n=PNGDecompress(t.buffer.slice(w,b));t.buffer=n,postMessage(t)}else t.rejected=!0,postMessage(t)}else t.rejected=!0,postMessage(t)}),Math.fmod=function(e,t){return Number((e-Math.floor(e/t)*t).toPrecision(8))};